### OSI七层参考模型

OSI 开放式的系统互联，学术上是分为7层，但在实际的应用中只有五层的结构

最顶层的`应用层(application layer)` 就是平时我们能够接触到的http https ftp dns snmp 等协议我们能

用来上网，发邮件，下载电影等等，在信息发送的过程中，需要`表示层(persentation layer)`对数据进行加密，或者数据压缩,以保证两个系统间的消息发送

能相互被识别，通过加密而确保安全。`会话层(session layer)`就是负责建立，管理中断，表示层实体之间的通信会话。该层的通信由设备中的应用程序之间的服务请求和相应组成

`传输层(transport layer)`建立了主机端到端的链接，把传输表头加至数据以形成数据包。传输表头包含了所有使用的
协议等发送信息。列如：传输控制协议TCP
`网络层(Network layer)`决定数据的路径选择和转寄，将网络表头（NH）加至数据包，以形成分组。
网络表头包含了网络数据.如ip
`数据链路层（data Link Layer）` 负责网路寻址，错误侦测和改错。当表头和表尾被加至数据包
时，会形成帧。数据链表头（DLH）是包含了物理地址和错误侦测及改错的方法。数据链表尾是一串指示数据
包末端的字符串。如以太网，无线局域网

分为两个子层：逻辑链路(`llc`logical link control)控制子层和介质访问控制（`Mac` medium access control）子层

`物理层`在局部局域网上传输数据帧，负责计算机通讯设备和网络媒体之间的互通-网线,网卡等


    应用层      | 文件传输，电子邮件，文件服务，虚拟终端  | TFTP HTTP SNMP FTP DNS
    表示层      | 数据格式化，代码转化，数据加密                   
    会话层      | 解除或建立与别的节点的联系
    传输层      | 提供端对端的接口                    | TCP UDP
    网络层      | 为数据包选择路由                    | IP ICMP RIP OSPF BGP IGMP 
    链路层      | 传输有效地址的祯以及错误检测          | SLIP CSLIP PPP ARP RARP MTU
    物理层      | 以二进制数据形式在物理媒体上传输数据   | ISO2110 IEEE802 IEEE802.2
    
    
这些模型规定了这么多的协议，层级，目的当然是为了让网络通信能够安全愉快的进行下去了
要与外界通信，首先要先确定我们能和其他终端互联，在一个局域网也好，在以太网也好，那么需要测试一下
可以通过`ping`来对其他终端发送数据报，然后通过反馈来确定是否联通了

`ping`命令是在网络层的，它是依据icmp协议的，那么在它发送数据的过程中发生了如下的几个过程

生成一个数据包，包含有date 和 type type就是他的协议类型，也就是ICMP
然后经过经过本层的ip协议，增一个ip首部，有源地址，和目标地址，就成了ip报文段， 一般会根据子网掩码来判断是否在同一局域网
然后下一层，即使数据链路层，ARP 会查询本地的缓存中有没有该ip的MAC，没有的话会在同一网段广播，如果刚好在同一网段，那么
在该层(数据链路层)将MAC的信息装到该数据包的头部，然后在尾部加上CRC(记录包是否损坏，)，封装成数据帧，发送，如果没有那么就需要到路由中查询，
根据路由找到ip，然后来到这个ip对应的电脑的网关，然后开始拆包了，怎么装的就怎么拆呗，拆到最后发现是ICMP协议，然后该ip电脑
发个包在根据这么一系列的东西很快的发回去就完成了一次通信，那么通过这个发送，返回的时间来计算网络的联通性，和当网速的快慢
ping 的工作流程大抵如此

当然日常的上网肯定不是使用ICMP的协议，而是使用应用层的协议，比如HTTP，FTP，NFS， DNS等
那么一次网页请求的过程就更加的复杂了，首先我理解的过程，对与一个网址，要访问一个网站的过程
对于网址，一般的网站都被`DNS`映射成了字符的形式，那么首先应该是DNS将网址解析成对应的ip地址，然后对这个ip进行访问
解析完成后就要发送http请求，那么对于应用层的http肯定要结果下面几层的层层包装，首先是表示层对数据进行加密，对数据的一些
处理然后Session layer 这个层是建立连接 管理中断，那不是和tcp冲突了，实际中上三层被归化成一起了，这个有问题先搁置
然后走到TCP/UDP层，也即使transport layer 这一层开始有协议了，tcp，是稳定连续的连接，udp包发完就不管了，要看一个网站 
当然是要一个稳定连续可交互的协议，当然是选择TCP协议了，那么要建立一次tcp的稳定连接，当然要用TCP的三次握手协议，
那么此时的http请求的用户数据暂时搁置在这里，要进行tcp连接通道的建立，tcp 给目标地址的端口，对了这时候是需要端口的，http在请求时
就包含了目标地址的端口,一般是隐式的，但（这个端口好像没有啊存疑）tcp开始给目标机器发送一个同步请求SYN=1和一个生成的数字num=x，
源地址ip加上目标地址ip，和type协议类型，在经过数据链路层加上一个MAC地址头部和CRC包损坏标识，封装成数据帧，转换成高低电压
经过光纤双绞线等物理介质也就是物理层。目标机器得到这么些的电信号,从物理层电信号开始
转换成数据帧，数据链路层去校验CRC是否完整，如果不完整就将其丢弃，（丢去之后呢，怎么要求重发啊）检验完整，
开始继续拆包，得到得到源ip的MAC地址，再拆得到目标ip，此时还在数据链路层，这时候
应该在路由器中，ARP 检索，或者广播得到ip对应的MAC地址，将其发送过去（等等，这个
目标地址的MAC 是在路由中解析的也就是，路由已经将原始数据包拆了一次，拆到了源ip，源mAC，和目标IP
得到目标ip后，再ARP在路由表中通过目标ip找到对应的机器MAC，然后在将数据装好，发给目标IP的MAC
目标机器得到数据帧后在进行拆分，校验CRC，得到源机器的MAC地址，和对应的ip地址，
此时在APR缓存中写入这一次请求，然后到网络层，拆开得到ip了，（这里有一个问题）
就是ARP缓存是什么时候写入的，在数据链路层的时候只得到了 mAC 在 网络层才得到ip
是神马时候写入的呢，`？`
然后到了`transport layer` 拆封发现是使用的TCP 的type，得到了另一台机器的同步申请
和随机产生的数字。目标机器的TCP 此时回复的信息就是确认收到ACK=1，然后将源地址的随机数字
+1,在产生一个随机数字，经过层层的打包，发送回源地址，还是经过传输层，网络层，数据链路层
物理层发送回去，源地址得到回应，并确定了服务器回复的数字是一开始生成的数字加一，
然后在回复ACK=1确认受到，和目标机器产生的随机数+1并发送http的date,打包发给
目标机器，目标机器受到确认，然后tcp连接建立，目标机器发送给请求地址传输数据tcp建立连接

数据传输完成后，开始关闭tcp连接，因为tcp连接是占据资源的
数据传输完成后如果客户端在一个时间段没有动作，那么就会关闭tcp连接，服务端完成
服务端，发个FIN=1 随机数m 表示完成了，客户端收到，回个ACK=1 m+1 表示知道了
如果客户端想关闭这次tcp服务，那么就会给客户端发送FIN=1 随机数k, 服务端收到
在回个ACK=1 k+1 就会关闭这次连接，


这些五层或者是七层的模型就是为了，保证通信过程能够顺利安全的进行
要进行一次完整的通信过程，
首先在应用层，发送要发送的报文一般指的是完整的信息，传输层实现报文交付
传输层：报文段
网络层：分组


路由器与交换机的差别，路由器是属于OSI第三层的产品，交換机是OSI第二层的产品。第二层的产品功能在于，
将网络上各个计算机的MAC地址记在MAC地址表中，当局域网中的计算机要经过交換机去交换传递数据时，
就查询交換机上的MAC地址表中的信息，将数据包发送给指定的计算机，而不会像第一层的产品（如集线器）每台在网络中的计算机都发送。
而路由器除了有交換机的功能外，更拥有路由表作为发送数据包时的依据，在有多种选择的路径中选择最佳的路径。
此外，并可以连接两个以上不同网段的网络，而交換机只能连接两个。
并具有IP分享的功能，如：区分哪些数据包是要发送至WAN。路由表存储了（向前往）某一网络的最佳路径，该路径的“路由度量值”以及下一个（跳路由器）。
参考条目路由获得这个过程的详细描述。

尽管也有其它一些很少用到的被路由协议，但路由通常指的就是IP路由。